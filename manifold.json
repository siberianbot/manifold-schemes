{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://siberianbot.me/manifold/schema",

  "title": "Manifold Document",
  "description": "Scheme for Manifold project or workspace definition",
  "type": "object",

  "oneOf": [
    { "$ref": "#/$defs/projectDefinition" },
    { "$ref": "#/$defs/workspaceDefinition" }
  ],

  "$defs": {
    "manifoldName": {
      "type": "string",
      "pattern": "[a-zA-Z0-9\\-\\_\\.]+"
    },

    "projectDefinition": {
      "type": "object",
      "properties": {
        "project": {
          "type": "object",
          "$ref": "#/$defs/project",
          "description": "Project definition"
        },
        "dependencies": {
          "type": "array",
          "description": "Project dependencies, which could be defined within workspace or located somewhere outside of project directory",
          "items": {
            "type": "object",
            "$ref": "#/$defs/dependency"
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "steps": {
          "type": "array",
          "description": "Collection of steps which should be executed by Manifold",
          "items": {
            "type": "object",
            "$ref": "#/$defs/step"
          },
          "minItems": 1
        }
      },
      "required": ["project", "steps"]
    },

    "workspaceDefinition": {
      "type": "object",
      "properties": {
        "workspace": {
          "type": "object",
          "$ref": "#/$defs/workspace",
          "description": "Workspace definition"
        },
        "includes": {
          "type": "array",
          "description": "Collection of projects or workspaces which are included in this workspace",
          "items": {
            "type": "string",
            "$ref": "#/$defs/include"
          },
          "minItems": 1
        }
      },
      "required": ["workspace", "includes"]
    },

    "project": {
      "type": "object",
      "properties": {
        "name": {
          "$ref": "#/$defs/manifoldName",
          "description": "A well-known name of project, which should be used wherever it possible in Manifold"
        }
      },
      "required": ["name"]
    },

    "workspace": {
      "type": "object",
      "properties": {
        "name": {
          "$ref": "#/$defs/manifoldName",
          "description": "A well-known name of workspace, which should be used wherever it possible in Manifold"
        }
      },
      "required": ["name"]
    },

    "include": {
      "type": "string"
    },

    "dependency": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/$defs/workspaceDependency" },
        { "$ref": "#/$defs/pathDependency" }
      ]
    },

    "workspaceDependency": {
      "type": "object",
      "properties": {
        "project": {
          "$ref": "#/$defs/manifoldName",
          "description": "A name of dependent project, included in workspace"
        }
      },
      "required": ["project"]
    },

    "pathDependency": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string",
          "description": "A path to dependent project, placed somewhere outside of project directory"
        }
      },
      "required": ["path"]
    },

    "step": {
      "type": "object",
      "oneOf": [{ "$ref": "#/$defs/cmdStep" }],

      "properties": {
        "stage": {
          "type": "string",
          "description": "A name of execution stage"
        }
      }
    },

    "cmdStep": {
      "type": "object",
      "properties": {
        "cmd": {
          "type": "string",
          "description": "Command for execution via command line"
        }
      },
      "required": ["cmd"]
    }
  }
}
